<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>给玉铃的“爱的频率”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        /* 密码层 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .password-box {
            text-align: center;
            background: rgba(30, 30, 30, 0.9);
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .password-box h2 {
            color: gold;
            margin-bottom: 20px;
            font-family: 'Ma Shan Zheng', cursive;
        }

        .password-box p {
            margin-bottom: 20px;
            color: #ccc;
        }

        #passwordInput {
            padding: 10px;
            font-size: 16px;
            border: 2px solid gold;
            background: transparent;
            color: #fff;
            border-radius: 5px;
            margin-bottom: 20px;
            width: 250px;
        }

        #submitPassword {
            background: gold;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #submitPassword:hover {
            background: #ffd700aa;
            transform: scale(1.05);
        }

        /* 星空 */
        #starfield {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
        }

        .star:hover {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 1);
        }

        .star-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: gold;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        /* 音乐播放器 */
        #player {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            z-index: 900;
            overflow: hidden;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255, 215, 0, 0.1);
            border-bottom: 1px solid gold;
        }

        #closePlayer {
            background: none;
            border: none;
            color: gold;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        #closePlayer:hover {
            transform: scale(1.1);
        }

        .player-body {
            padding: 20px;
        }

        #playerWidget {
            width: 100%;
            height: 300px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
        }

        .lyrics-section, .note-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .lyrics-section h4, .note-section h4 {
            color: gold;
            margin-bottom: 10px;
            font-family: 'Ma Shan Zheng', cursive;
        }

        #currentLyrics {
            font-style: italic;
            color: #ccc;
            line-height: 1.6;
        }

        #userNote {
            width: 100%;
            height: 100px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid gold;
            color: #fff;
            border-radius: 5px;
            margin-bottom: 10px;
            resize: vertical;
        }

        #saveNote {
            background: gold;
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #saveNote:hover {
            background: #ffd700aa;
        }

        #noteStatus {
            color: #4CAF50;
            font-size: 12px;
            margin-top: 5px;
        }

        /* 解锁提示 */
        #unlockToast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(30, 30, 30, 0.95);
            color: gold;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-toast {
            font-size: 1.5rem;
            cursor: pointer;
            font-weight: bold;
            color: gold;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .close-toast:hover {
            opacity: 1;
        }

        /* 信封图标 */
        #envelopeBtn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: gold;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 800;
        }

        #envelopeBtn:hover {
            transform: scale(1.1);
            color: white;
        }

        /* 信件模态框 */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: rgba(30, 30, 30, 0.95);
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
        }

        .close-modal {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: gold;
        }

        .letter-paper {
            background: rgba(255, 255, 255, 0.95);
            color: #000;
            padding: 30px;
            border-radius: 5px;
            font-family: 'Ma Shan Zheng', cursive;
            line-height: 1.8;
        }

        .letter-paper h2 {
            color: #8B0000;
            margin-bottom: 20px;
            text-align: center;
        }

        .signature {
            text-align: right;
            margin-top: 30px;
            font-weight: bold;
        }

        /* 底部控制栏 */
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 800;
        }

        .controls button {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid gold;
            color: gold;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .controls button:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: scale(1.05);
        }

        /* 动画 */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .hidden {
            display: none !important;
        }

        /* 呼吸动画 */
        .breathing {
            animation: breathe 3s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% {
                opacity: 0.8;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body>
    <!-- 密码层 -->
    <div id="passwordOverlay" class="overlay active">
        <div class="password-box">
            <h2><i class="fas fa-lock"></i> 私人频率</h2>
            <p>请输入专属通行证</p>
            <input type="password" id="passwordInput" placeholder="输入密码...">
            <button id="submitPassword"><i class="fas fa-paper-plane"></i> 进入星空</button>
            <p class="hint">提示：密码是你的生日</p>
        </div>
    </div>

    <!-- 主星空容器 -->
    <div id="starfield"></div>

    <!-- 音乐播放器 -->
    <div id="player" class="hidden">
        <div class="player-header">
            <span id="nowPlaying">《才二十三》 - 欢迎序曲</span>
            <button id="closePlayer"><i class="fas fa-times"></i></button>
        </div>
        <div class="player-body">
            <!-- 播放器iframe将由JS动态注入 -->
            <div id="playerWidget"></div>
            <div class="lyrics-section">
                <h4><i class="fas fa-quote-left"></i> 此刻的歌词</h4>
                <p id="currentLyrics">未来还有什么疑问？才二十三</p>
            </div>
            <div class="note-section">
                <h4><i class="fas fa-edit"></i> 你的笔记 (仅保存在此电脑)</h4>
                <textarea id="userNote" placeholder="写下为什么喜欢这句，或此刻的心情..."></textarea>
                <button id="saveNote"><i class="fas fa-save"></i> 保存笔记</button>
                <p id="noteStatus"></p>
            </div>
        </div>
    </div>

    <!-- 解锁提示 -->
    <div id="unlockToast" class="hidden">
        <i class="fas fa-star"></i> <span id="unlockMessage">新歌曲已解锁！</span>
        <span class="close-toast">&times;</span>
    </div>

    <!-- 信封图标 -->
    <button id="envelopeBtn" class="hidden" title="有一封信">
        <i class="fas fa-envelope"></i>
    </button>

    <!-- 信件模态框 -->
    <div id="letterModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="letter-paper">
                <h2>给玉铃</h2>
                <div id="letterContent">
                    <p>亲爱的玉铃：</p>
                    <p>当你看到这封信时，我希望你已经沉浸在这个音乐的宇宙里了。这是我为你准备的一个小礼物，包含了我想对你说的话和我们一起听过的那些特别的歌曲。</p>
                    <p>每一颗星星都代表着一首我精心挑选的歌，它们承载着我们的回忆和我对你的思念。点击它们，你会听到熟悉的旋律，看到我想对你说的话。</p>
                    <p>这段时间以来，你一直是我生活中最亮的星星。你的笑容、你的陪伴、你的鼓励，都让我感到无比幸福。我想通过这个小小的音乐宇宙，把我心中的爱和感激都告诉你。</p>
                    <p>愿这个音乐宇宙能给你带来快乐和温暖，就像你给我的一样。无论何时何地，只要你需要，这些歌曲都会陪伴着你。</p>
                    <p>爱你的，</p>
                    <p>庞佳君</p>
                </div>
                <p class="signature">庞佳君</p>
            </div>
        </div>
    </div>

    <!-- 底部控制栏 -->
    <div class="controls">
        <button id="toggleMusic"><i class="fas fa-music"></i> <span>暂停背景音</span></button>
        <button id="toggleStars"><i class="fas fa-star"></i> <span>隐藏星星</span></button>
        <button id="resetBtn"><i class="fas fa-redo"></i> <span>重置进度</span></button>
    </div>

    <script>
        // 全局变量
        const PASSWORD = "1";
        const AUTO_PLAY_SONG_ID = 1;
        let isBackgroundMusicPlaying = true;
        let starsVisible = true;
        let currentSongId = null;
        let stars = [];
        let progress = { "unlockedSongs": [0, 1] };
        let backgroundMusic = null;

        // 歌曲数据
        const songs = [
            {
                id: 0,
                title: "Love Song",
                artist: "方大同",
                lyrics: "我们爱的简单 爱的深刻 爱的自然\n永远不会变 直到海枯石烂\n我们的爱像首歌 唱到永远",
                iframe: "<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"D:/FDT/fdt/music/Love song.mp3\"></iframe>",
                reason: "这首歌代表了我对你的爱，简单而深刻",
                unlocked: true,
                position: { x: 30, y: 40 }
            },
            {
                id: 1,
                title: "特别的人",
                artist: "方大同",
                lyrics: "我们是对方 特别的人\n奋不顾身 难舍难分\n不是一般人的认真",
                iframe: "<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86 src=\"D:/FDT/fdt/music/特别的人.mp3\"></iframe>",
                reason: "你就是我生命中特别的人，无可替代",
                unlocked: true,
                position: { x: 70, y: 30 }
            },
            {
            id: 2,
            title: "麦恩莉",
            artist: "方大同",
            lyrics: "我终于遇到了你，我麦恩莉，多么甜蜜，我属于你。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/麦恩莉.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "听过《特别的人》，再来听听这首'幸运版'的故事。'我终于遇到了你，我麦恩莉'，这是方大同写下的，最直白的幸运。",
            unlocked: false,
            position: { x: 20, y: 70 }
        },
        {
            id: 3,
            title: "因为你",
            artist: "方大同",
            lyrics: "因为你，我多么幸运，多么幸运，多么幸运，因为你。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/因为你(Live).mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "从'幸运'到'原因'。爱常常没有理由，但大同在这首歌里，把'因为你'这个理由，唱成了最甜美的因果律。",
            unlocked: false,
            position: { x: 80, y: 30 }
        },
        {
            id: 4,
            title: "为你写的歌",
            artist: "方大同",
            lyrics: "我们的故事未完待续，让我为你写一首歌，纪念这美丽的爱情。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/为你写的歌.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "看歌名就知道，它应该出现在这里。这不是情书，却比情书更温柔。'我们的故事未完待续'，像极了我们。",
            unlocked: false,
            position: { x: 40, y: 20 }
        },
        {
            id: 5,
            title: "三人游",
            artist: "方大同",
            lyrics: "有些话你选择不对他说，你说某种脆弱，我才感同身受。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/三人游.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "爱不只是甜蜜，也有犹豫和退让。这首经典的'备胎之歌'，藏着一种安静的慷慨。或许，我们都曾如此。",
            unlocked: false,
            position: { x: 60, y: 80 }
        },
        {
            id: 6,
            title: "听",
            artist: "方大同",
            lyrics: "听我唱，一首歌，一首简单的歌，一首不复杂的歌。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/听.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "在复杂的情绪之后，让我们'听'回最简单的需求。'听我唱，一首歌'，让我陪着你，无论以何种形式。",
            unlocked: false,
            position: { x: 25, y: 50 }
        },
        {
            id: 7,
            title: "爱爱爱",
            artist: "方大同",
            lyrics: "爱爱爱，爱爱爱，爱爱爱爱爱爱爱，到底什么是爱？",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/爱爱爱.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "从具体回到抽象。究竟什么是爱？这首歌里有繁华世界的千万种答案，而我的答案，与你有关。",
            unlocked: false,
            position: { x: 75, y: 45 }
        },
        {
            id: 8,
            title: "关于爱的定义",
            artist: "方大同",
            lyrics: "关于爱的定义，关于你的意义，关于我们之间的默契。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/关于爱的定义.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "承接上一首的思考。如果非要给爱一个定义，那么'和你在一起'就是我最满意的词典解释。",
            unlocked: false,
            position: { x: 50, y: 65 }
        },
        {
            id: 9,
            title: "春风吹",
            artist: "方大同",
            lyrics: "春风吹，春风吹，吹红了桃花，吹绿了柳树。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/春风吹.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "吹走所有沉重。这是方大同音乐里最清新的一阵风，带着复古的律动。希望它也能吹过你，带来好心情。",
            unlocked: false,
            position: { x: 35, y: 75 }
        },
        {
            id: 10,
            title: "天气先生",
            artist: "方大同",
            lyrics: "你的心情，是我的天气预报，晴天雨天，我都知道。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/天气先生.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "你的心情，是我的天气预报。这首歌像一份俏皮的关心，提醒我，要永远做那个为你预报晴天的'先生'。",
            unlocked: false,
            position: { x: 65, y: 25 }
        },
        {
            id: 11,
            title: "红豆",
            artist: "方大同",
            lyrics: "还没好好地感受，醒着亲吻的温柔，可能从此以后，学会珍惜天长和地久。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/红豆.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "压轴曲。他把别人的经典，唱成了自己的告白。'还没好好地感受，醒着亲吻的温柔'——有些遗憾的美，让我们更珍惜此刻。",
            unlocked: false,
            position: { x: 45, y: 55 }
        },
        {
            id: 12,
            title: "才二十三",
            artist: "方大同",
            lyrics: "未来还有什么疑问？才二十三，人生的乐章，才刚刚开始。",
            embedCode: '<audio controls style="width: 100%; height: 86px;"><source src="music/才二十三.mp3" type="audio/mpeg">您的浏览器不支持音频播放</audio>',
            reason: "最后一颗星。'未来还有什么疑问？'，二十三岁有无限可能，而你的未来，无论乐章如何谱写，我永远是你的头号听众。",
            unlocked: false,
            position: { x: 50, y: 50 }
        }
    ];

        // 初始化应用
        function initApplication() {
            // 创建星空背景
            createStarfield();
            
            // 创建星星
            createStars();
            
            // 加载进度
            progress = loadProgress();
            
            // 创建控制按钮
            createControls();
            
            // 创建背景音乐
            backgroundMusic = new Audio('https://music.163.com/song/media/outer/url?id=28563779.mp3');
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.3;
            
            // 密码输入事件
            document.getElementById('submitPassword').addEventListener('click', checkPassword);
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });

            // 显示欢迎信息
            setTimeout(() => {
                showUnlockToast("欢迎你，玉铃。点击星星开始探索音乐宇宙吧～");
            }, 1000);
        }

        // 检查密码
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === PASSWORD) {
                const passwordOverlay = document.getElementById('passwordOverlay');
                passwordOverlay.style.opacity = '0';
                setTimeout(() => {
                    passwordOverlay.style.display = 'none';
                    document.getElementById('envelopeBtn').classList.remove('hidden');
                }, 800);
                // 密码正确后，不自动播放任何歌曲，让用户自己选择
            } else {
                alert('密码错误，请重试！');
            }
        }

        // 创建星空背景
        function createStarfield() {
            const starfield = document.getElementById('starfield');
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.style.position = 'absolute';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.backgroundColor = 'white';
                star.style.borderRadius = '50%';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.opacity = Math.random() * 0.8 + 0.2;
                star.style.boxShadow = '0 0 5px white';
                starfield.appendChild(star);
            }
        }

        // 创建歌曲星星
        function createStars() {
            const starfield = document.getElementById('starfield');
            
            songs.forEach(song => {
                if (progress.unlockedSongs.includes(song.id)) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.width = '20px';
                    star.style.height = '20px';
                    star.style.backgroundColor = 'gold';
                    star.style.left = song.position.x + '%';
                    star.style.top = song.position.y + '%';
                    star.dataset.songId = song.id;
                    
                    // 创建标签
                    const label = document.createElement('div');
                    label.className = 'star-label';
                    label.textContent = `${song.title} - ${song.artist}`;
                    label.style.left = '100%';
                    label.style.top = '50%';
                    label.style.transform = 'translateY(-50%)';
                    star.appendChild(label);
                    
                    // 添加点击事件
                    star.addEventListener('click', () => playSong(song.id));
                    
                    // 添加悬停效果
                    star.addEventListener('mouseenter', () => {
                        label.style.opacity = '1';
                    });
                    
                    star.addEventListener('mouseleave', () => {
                        label.style.opacity = '0';
                    });
                    
                    starfield.appendChild(star);
                    stars.push(star);
                    
                    // 为前两颗星添加呼吸动画
                    if (song.id < 2) {
                        star.classList.add('breathing');
                    }
                }
            });
        }

        // 播放歌曲
        function playSong(songId) {
            const song = songs.find(s => s.id === songId);
            if (!song) return;
            
            currentSongId = songId;
            
            // 更新播放信息
            document.getElementById('nowPlaying').textContent = `《${song.title}》 - ${song.artist}`;
            document.getElementById('currentLyrics').textContent = song.lyrics;
            
            // 加载播放器
            document.getElementById('playerWidget').innerHTML = song.iframe;
            
            // 加载用户笔记
            document.getElementById('userNote').value = getNote(songId) || '';
            
            // 显示播放器
            document.getElementById('player').classList.remove('hidden');
            
            // 记录播放历史
            recordPlay(songId);
        }

        // 关闭播放器
        function closePlayer() {
            document.getElementById('player').classList.add('hidden');
            document.getElementById('playerWidget').innerHTML = '';
        }

        // 创建控制按钮
        function createControls() {
            // 关闭播放器按钮
            document.getElementById('closePlayer').addEventListener('click', closePlayer);
            
            // 保存笔记按钮
            document.getElementById('saveNote').addEventListener('click', () => {
                const note = document.getElementById('userNote').value;
                if (currentSongId !== null) {
                    saveNote(currentSongId, note);
                }
            });
            
            // 切换背景音乐
            document.getElementById('toggleMusic').addEventListener('click', () => {
                if (isBackgroundMusicPlaying) {
                    backgroundMusic.pause();
                    document.querySelector('#toggleMusic span').textContent = '播放背景音';
                } else {
                    backgroundMusic.play().catch(error => {
                        console.log('背景音乐播放失败:', error);
                    });
                    document.querySelector('#toggleMusic span').textContent = '暂停背景音';
                }
                isBackgroundMusicPlaying = !isBackgroundMusicPlaying;
            });
            
            // 切换星星可见性
            document.getElementById('toggleStars').addEventListener('click', () => {
                const starElements = document.querySelectorAll('.star');
                if (starsVisible) {
                    starElements.forEach(star => star.style.display = 'none');
                    document.querySelector('#toggleStars span').textContent = '显示星星';
                } else {
                    starElements.forEach(star => star.style.display = 'block');
                    document.querySelector('#toggleStars span').textContent = '隐藏星星';
                }
                starsVisible = !starsVisible;
            });
            
            // 重置进度
            document.getElementById('resetBtn').addEventListener('click', () => {
                if (confirm('确定要重置所有进度吗？这将删除所有笔记和解锁记录。')) {
                    localStorage.removeItem('musicUniverseProgress');
                    progress = loadProgress();
                    location.reload();
                }
            });
            
            // 信封按钮
            document.getElementById('envelopeBtn').addEventListener('click', () => {
                document.getElementById('letterModal').classList.remove('hidden');
            });
            
            // 关闭信件模态框
            document.querySelector('.close-modal').addEventListener('click', () => {
                document.getElementById('letterModal').classList.add('hidden');
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', (e) => {
                const modal = document.getElementById('letterModal');
                if (e.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        }

        // 显示解锁提示
        function showUnlockToast(message) {
            const toast = document.getElementById('unlockToast');
            const messageElement = document.getElementById('unlockMessage');
            const closeToast = document.querySelector('.close-toast');
            messageElement.textContent = message;
            toast.classList.remove('hidden');
            
            // 添加关闭按钮事件监听
            closeToast.addEventListener('click', function() {
                toast.classList.add('hidden');
            });
            
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // 加载进度
        function loadProgress() {
            const saved = localStorage.getItem('musicUniverseProgress');
            if (saved) {
                return JSON.parse(saved);
            }
            // 默认只解锁前两首歌
            return { unlockedSongs: [0, 1] };
        }

        // 保存进度
        function saveProgress() {
            localStorage.setItem('musicUniverseProgress', JSON.stringify(progress));
        }

        // 记录播放
        function recordPlay(songId) {
            // 简单的记录逻辑，可以扩展为更复杂的解锁机制
            if (!progress.unlockedSongs.includes(songId)) {
                progress.unlockedSongs.push(songId);
                saveProgress();
                showUnlockToast(`新歌曲《${songs.find(s => s.id === songId).title}》已解锁！`);
            }
        }

        // 保存笔记
        function saveNote(songId, note) {
            if (!progress.notes) {
                progress.notes = {};
            }
            progress.notes[songId] = note;
            saveProgress();
            
            const status = document.getElementById('noteStatus');
            status.textContent = '笔记已保存！';
            setTimeout(() => {
                status.textContent = '';
            }, 2000);
        }

        // 获取笔记
        function getNote(songId) {
            return progress.notes ? progress.notes[songId] : null;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initApplication);
    </script>
</body>
</html>